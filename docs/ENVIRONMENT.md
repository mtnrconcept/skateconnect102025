# Environment Configuration

This project relies on a small set of environment variables to connect the Vite
front-end to Supabase services, Mapbox tiles, and the native push notification
stack. Create a `.env` file at the project root (or update your Vite/CI
configuration) with the variables described below.

> Vite only exposes variables prefixed with `VITE_` to the client bundle.

| Variable | Required | Description | Example |
| --- | --- | --- | --- |
| `VITE_SUPABASE_URL` | Yes | Base URL of your Supabase project (copy it from the "Project Settings → API" page). | `https://abc123.supabase.co` |
| `VITE_SUPABASE_ANON_KEY` | Yes | Public anon key generated by Supabase for client-side access. Use the key found under "Project Settings → API". | `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...` |
| `VITE_MAPBOX_TOKEN` | Yes (for map features) | Mapbox access token that unlocks the interactive skate spot map. Obtain it from your Mapbox account dashboard. | `pk.eyJ1Ijoic2thdGVjb25uZWN0IiwiYSI6Im...` |
| `VITE_STRIPE_PUBLISHABLE_KEY` | Optional (required for checkout) | Stripe publishable key used by the public shop to load Stripe.js and redirect to Checkout. | `pk_live_123` |

### Edge Functions & Stripe configuration

Deploying the Stripe-powered marketplace requires setting a few secrets for the
Supabase Edge Functions (`shop-checkout`, `shop-connect`, `shop-webhook`):

| Variable | Description |
| --- | --- |
| `STRIPE_SECRET_KEY` | Platform secret key (starts with `sk_live_`). |
| `STRIPE_WEBHOOK_SECRET` | Webhook signing secret for events targeting `shop-webhook`. |
| `STRIPE_PLATFORM_COMMISSION_PERCENT` | Commission applied on each order (default 10). |
| `SHOP_ALLOWED_ORIGINS` | Comma-separated list of origins allowed to call `shop-checkout` (e.g. `https://app.example.com`). |
| `SHOP_PLATFORM_URL` | Public URL of SkateConnect, exposed in the Stripe Express dashboard. |
| `SHOP_STRIPE_RETURN_URL` / `SHOP_STRIPE_REFRESH_URL` | Optional overrides for the onboarding success/refresh URLs. |

## Push notification tokens

The Capacitor integration persists push tokens inside the `push_tokens` table in
Supabase. No additional Vite variables are required, but you must provision
native credentials per platform:

- **Android (FCM):** Create a Firebase project, enable Cloud Messaging, and add
your `google-services.json` when building the Android shell. The token
registration flow will save the tokens to Supabase via the existing
`push_tokens` table.
- **iOS (APNs):** Generate an APNs key or certificates, configure them in the
Apple Developer portal, and add the resulting `GoogleService-Info.plist` (for
Firebase/APNs bridging) to the Xcode project.

Refer to [`CAPACITOR_SETUP.md`](../CAPACITOR_SETUP.md) for detailed native
configuration steps and [`MEDIA_SYSTEM.md`](../MEDIA_SYSTEM.md) for how push
messages interact with uploaded media.

## Local development tips

1. Duplicate `.env` to `.env.local` to isolate machine-specific credentials.
2. Restart the dev server (`npm run dev`) whenever you change the `.env`
   file—Vite only loads environment variables at startup.
3. Avoid committing secrets to the repository. Use your deployment platform’s
   secret manager (Vercel/Netlify/Supabase) for production values.
